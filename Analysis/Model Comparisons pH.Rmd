---
title: "Model comparisons"
output: html_notebook
---

# Introduction
Because GAM models are large, I ran them in a separate Notebook, and saved them. Here I compare models, especially to gain insight onto data anlysis choices and hteir potential impact.

# Load Libraries
```{r}
library(tidyverse)
library(mgcv)
library(GGally)

#library(CBEPgraphics)
```

## Initiailze fonts
```{r warnings=FALSE, message=FALSE}
#load_cbep_fonts()
```

# Load model results
```{r}
the_gls  <- readRDS('GLS_ph.rds')
monthf   <- readRDS('GAM1_ph.rds')
monthv   <- readRDS('GAM1.mm_ph.rds')
doyr   <- readRDS('GAM1.doy.1_ph.rds')
doyr2   <- readRDS('GAM1.doy.2_ph.rds')

monthv_nocycle <- readRDS('GAM1.mm_ph_nocycle.rds')
doyr_nocycle <- readRDS('GAM1.doy.1_ph_nocycle.rds')
doyr2_nocycle <- readRDS('GAM1.doy.2_ph_nocycle.rds')
```

How do I know if I should take predictions from GAM or LME?  I think I need the GAM.
```{r}
preds <- tibble(
         gls = predict(the_gls),
         monthf = predict(monthf$gam),
         monthv = predict(monthv$gam),
         monthvnc =  predict(monthv_nocycle$gam),
         doyr   = predict(doyr$gam),
         doyrnc   = predict(doyr_nocycle$gam),
         doyr2  = predict(doyr2$gam),
         doyr2nc  = predict(doyr2_nocycle$gam))

sum(!is.na(preds$monthf))
```

```{r message=FALSE, warning=FALSE}
ggpairs(preds)
```
WOW!  those predictions differ a fair amount.   Note also that the paired DOY models are identical - -apparently because the algorithm did not fit a significant two dimensional periodic smoother.

WE can't look at multiple models in ANOVA looking at the GAM component, so we look at LME.  not sure if this is legitimate or not....
```{r}
anova(monthv_nocycle$lme, doyr_nocycle$lme,  doyr2_nocycle$lme,  monthf$lme)
```
Here, the clear winner is the simpler day of year model.

```{r}
resids <- tibble(
         monthf = residuals(monthf$gam, type = 'response'),
         monthv = residuals(monthv_nocycle$gam, type = 'response'),
         doyr = residuals(doyr_nocycle$gam, type = 'response'),
         doyr2 = residuals(doyr2_nocycle$gam, type = 'response')) %>%
  group_by(.) %>%
  summarize_all(~sqrt(mean(.^2, na.rm=TRUE)))
resids
```
interesting....  the mse is smaller for the mnth fits, despite poorer overal lmodel performnce by AIC....
# The GLS
```{r}
summary(the_gls)
```

There is definitely some unresolved structure....

## Seasonal Pattern
Note that we only have data from eight months.  We are missing pH data from the winter, and data is sparse in some months.
```{r}

```

```{r}
plot(1:8,c(0,coef(the_gls)[2:8]), type = 'l')

```
pH drops over the season?  Note limited months available

##Daily Pattern
```{r}
cc <- coef(the_gls)[9:12]
hh = 1:24
vv =  cc[1] * sin(((2 * pi)/24) * hh) + 
      cc[2] * cos(((2 * pi)/24) * hh) +
      cc[3] * sin(((4 * pi)/24) * hh) +
      cc[4] * cos(((4 * pi)/24) * hh)
plot(hh,vv, type = 'l')
```
Note magnitude of daily pattern is about an order of magnitude smaller than the seasonal pattern.
# Moddel fitting month using a smooth function
```{r}
anova(monthv_nocycle$gam)
```


```{r}
plot(monthv_nocycle$gam)
```


```{r}
plot(doyr_nocycle$gam)
```


```{r}
plot(doyr2_nocycle$gam)
```
But here the two way pattern is NOT strong. 

```{r}
anova(doyr2_nocycle$gam) 
```

```{r}

```






